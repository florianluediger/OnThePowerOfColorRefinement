\section{Ergebnis und Laufzeit}
\label{sec/ergebnis}

%\begin{itemize}
%	\item Erklärung von Theorem 9
%	\item Vorstellung des Ergebnisses
%	\item Beweis der Laufzeit von $O((n+m)\log n)$
%\end{itemize}

Die vorgestellten lokalen und globalen Eigenschaften von CR-Graphen reichen wie im Folgenden gezeigt aus, um hinreichende Bedingungen für CR-Graphen zu formulieren und darauf basierend ein effizientes Verfahren für das Erkennen solcher Graphen zu entwickeln.

\subsection{Hinreichende Bedingungen für das Erkennen von CR-Graphen}
\begin{Theorem}
	Für einen Graphen $G$ sind folgende Aussagen äquivalent:
	
	\begin{enumerate}[label=(\alph*)]
		\item $G$ ist ein CR-Graph
		\item $G$ erfüllt Bedingungen \emph{A-F}
		\item $G$ erfüllt Bedingungen \emph{A}, \emph{B}, \emph{G} und \emph{H}
	\end{enumerate}
\end{Theorem}

\emph{Beweis:} Die Äquivalenz der Aussagen wird gezeigt, indem gezeigt wird, dass gilt: $(a)\rightarrow (b)\rightarrow (c)\rightarrow (a)$.
Die bisher erlangten Erkenntnisse ermöglichen es bereits einen großen Teil dieser Aussage zu bestätigen. Somit wurde in den Lemmata \ref{lemma:lokal} und \ref{lemma:global1} gezeigt, dass $(a)\rightarrow (b)$ gilt. Ebenfalls wurde in Lemma \ref{lemma:global2} gezeigt, dass $(b)\rightarrow (c)$ gilt. Es bleibt also nur noch zu zeigen, dass auch $(c)\rightarrow (a)$ gültig ist.\\

Sei dazu $G$ ein Graph, welcher die Bedingungen \emph{A}, \emph{B}, \emph{G} und \emph{H} erfüllt und $H$ ein durch Color Refinement nicht von $G$ unterscheidbarer Graph, dann ist zu zeigen, dass $G$ und $H$ isomorph sind.
Im Folgenden sei $C^s$ eine Knotenfärbung, welche zur stabilen Partition $\mathcal{P}^s$ von der \glslink{disjunkte_vereinigung}{disjunkten Vereinigung} $G+H$ gehört.
Aus Gleichung \ref{eq:2} folgt, dass es eine Abbildung $f:\mathcal{P}_G\rightarrow \mathcal{P}_H$ gibt, welche die Zellen der stabilen Partition von $G$ auf die der stabilen Partition von $H$ so abbildet, dass diese die selbe Farbe und Kardinalität besitzen.

\begin{Lemma}
	Die Abbildung $f$ stellt einen Isomorphismus von $C(G)$ nach $C(H)$ dar, sofern für beliebige $X,Y\in G$ gilt:
	\begin{enumerate}[label=(\alph*)]
		\item $G[X]\simeq H[f(X)]$ und
		\item $G[X,Y]\simeq H[f(X),f(Y)]$
	\end{enumerate}
	\label{lemma:zell_isomorphismus}
\end{Lemma}

Beweis für Lemma \ref{lemma:zell_isomorphismus} (a):
Sowohl $X$ als auch $f(X)$ sind reguläre Graphen, da diese Zellen einer stabilen Partition sind.
Da beide Zellen durch die Konstruktion von $f$ dieselbe Farbe besitzen und somit in der stabilen Partition $\mathcal{P}^s$ von $G+H$ in derselben Zelle liegen, haben die Graphen $G[X]$ und $H[f(X)]$ denselben Grad.
Aus dieser Eigenschaft und Bedingung \emph{A} folgt somit, dass $G[X]$ ein Unigraph ist, dessen Isomorphieeigenschaften durch seine Gradsequenzen vollständig definiert ist und daraus Behauptung (a) folgt.

Behauptung (b) folgt nach derselben Begründung aus Bedingung \emph{B}.\\

Da die in Lemma \ref{lemma:zell_isomorphismus} festgestellte Isomorphie zwischen den Zellgraphen $C(G)$ und $C(H)$ nicht ausreicht, um auf eine Isomorphie zwischen $G$ und $H$ zu schließen, wird im Folgenden der Isomorphismus $\phi $ aufgestellt.
Siehe dazu auch Kapitel \ref{sec/anwendungsbeispiel}, wo beschrieben wird, dass für den vorgestellten Graphen, welcher kein CR-Graph ist, die Bedingungen \emph{A} und \emph{B} dennoch erfüllt sind.
Lemma \ref{lemma:zell_isomorphismus} lässt darauf schließen, dass $\phi (X)=f(X)$ bereits ein gültiger Isomorphismus zum Abbilden der Subgraphen von Zellen aufeinander ist.

Die lokalen Eigenschaften von CR-Graphen helfen also dabei diesen Isomorphismus teilweise aufzustellen, dieser muss allerdings auch Zellübergreifend korrekt definiert sein, weshalb die globalen Eigenschaften ebenfalls erfüllt sein müssen.
Jede anisotrope Komponente $A$ des Zellgraphen $C(G)$ kann nach Bedingung \emph{H} maximal eine heterogene Zelle $R_A$ enthalten.
Sollte diese für eine Komponente nicht existieren, so sei $R_A$ eine beliebige Zelle minimaler Kardinalität in $A$.
Nach (a) kann $\phi$ für die Zelle $R_A$ jeder anisotroper Komponente ein beliebiger Isomorphismus von $G[R_A]$ nach $H[f(R_A)]$ sein.
Dieser Isomorphismus wird dann auf die anderen Zellen in $A$ übertragen, was im Folgenden genauer beschrieben wird.
Da $A$ nach Bedingung \emph{G} ein Baum ist, kann dieser von der Zelle $R_A$ gewurzelt werden, sodass der Baum $A_R$ entsteht.
Angenommen $\phi$ sei bereits für die Zelle $X$ definiert, so kann dieses über die Kante $G[X,Y]$ auf die Zelle $Y$ übertragen werden, da nach der Monotonievoraussetzung von Bedingung \emph{G} und der Wahl von $R_A$ gilt, dass $|X|\leq |Y|$.
Für die Zelle $Y$ muss $\phi$ dann nur noch so gewählt werden, dass dieses einen Isomorphismus von $G[X,Y]$ nach $H[f(X),f(Y)]$ darstellt, was wegen (b) und der Tatsache, dass alle Knoten von $Y$ den Grad 1 im bipartiten Graphen $G[X,Y]$ oder dessen bipartiten Komplement hat, was ebenfalls für $f(Y)$ gilt, möglich ist.\\

Da $\phi$ durch seine Konstruktion ein Isomorphismus zwischen $G[X]$ und $H[f(X)]$ sowie zwischen $G[X,Y]$ und $H[f(X),f(Y)]$ ist, ergibt sich, dass $\phi$ ebenfalls ein Isomorphismus von $G$ zu $H$ ist.

\subsection{Anwendungsbeispiel}
\label{sec/anwendungsbeispiel}
Um die Verwendung der unterschiedlichen Bedingungen zu veranschaulichen wird das aus Kapitel \ref{sec/cr} bekannte Beispiel, wie in Abbildung \ref{fig:anwendungsbeispiel} erkennbar, um zwei Knoten erweitert und im Folgenden auf die vorgestellten Bedingungen überprüft.
Im Bild sind außerdem die zu der stabilen Partition gehörenden Knotenfärbungen eingezeichnet worden.
Um die Zuordnung zu den Partitionen im Text zu erleichtern wird die von den blauen Knoten geformte Partition und deren Zellen $\mathcal{B}$, die der grünen Knoten $\mathcal{G}$ und die der roten Knoten $\mathcal{R}$ genannt.

\begin{figure}[t]
	\centering
	\begin{tikzpicture}
		\begin{scope}
			\node[main node] (1) [fill=green!30]{$1$};
			\node[main node] (2) [fill=red!30,below left = 0.8cm and 1.4cm of 1]  {$2$};
			\node[main node] (6) [fill=red!30,below right = 0.8cm and 1.4cm of 1] {$6$};
			\node[main node] (3) [fill=red!30,below = 1.4cm of 2] {$3$};
			\node[main node] (5) [fill=red!30,below = 1.4cm of 6] {$5$};
			\node[main node] (4) [fill=green!30,below right = 0.8cm and 1.4cm of 3] {$4$};
			\node[main node] (7) [above = 1.4cm of 1] {$7$};
			\node[main node] (8) [below = 1.4cm of 4] {$8$};
			
			\path[draw,thick]
			(1) edge node {} (2)
			(2) edge node {} (3)
			(3) edge node {} (4)
			(4) edge node {} (5)
			(5) edge node {} (6)
			(6) edge node {} (1)
			(1) edge node {} (7)
			(4) edge node {} (8);
		\end{scope}
		
		\node (simeq) [below right = 0.4cm and 1.3cm of 6] {\huge $\not\simeq$};
		
		\node (B) [below right = 2cm and -0.6cm of simeq] {$\rightarrow \mathcal{B}$};
		\node (G) [below = 0.2cm of B] {$\rightarrow \mathcal{G}$};
		\node (R) [below = 0.2cm of G] {$\rightarrow \mathcal{R}$};
		\node[main node] (B1) [left = 0cm of B] {};
		\node[main node] (G1) [fill=green!30,left = 0cm of G] {};
		\node[main node] (R1) [fill=red!30,left = 0cm of R] {};
		
		\begin{scope}[xshift=8cm]
			\node[main node] (1) [fill=green!30]{$1$};
			\node[main node] (2) [fill=red!30,below left = 0.8cm and 1.4cm of 1]  {$2$};
			\node[main node] (6) [fill=red!30,below right = 0.8cm and 1.4cm of 1] {$6$};
			\node[main node] (3) [fill=red!30,below = 1.4cm of 2] {$3$};
			\node[main node] (5) [fill=red!30,below = 1.4cm of 6] {$5$};
			\node[main node] (4) [fill=green!30,below right = 0.8cm and 1.4cm of 3] {$4$};
			\node[main node] (7) [above = 1.4cm of 1] {$7$};
			\node[main node] (8) [below = 1.4cm of 4] {$8$};
			
			\path[draw,thick]
			(1) edge node {} (2)
			(2) edge node {} (6)
			(3) edge node {} (4)
			(4) edge node {} (5)
			(5) edge node {} (3)
			(6) edge node {} (1)
			(1) edge node {} (7)
			(4) edge node {} (8);
		\end{scope}
	\end{tikzpicture}
	\caption{Zwei nicht isomorphe Graphen, welche vom Color Refinement nicht unterschieden werden können}
	\label{fig:anwendungsbeispiel}
\end{figure}

\emph{Bedingung A:} Bedingung \emph{A} wird von beiden Graphen erfüllt, denn $G[\mathcal{B}]$ und $G[\mathcal{G}]$ enthalten keine Kanten und $G[\mathcal{R}]$ ist ein matching-Graph.

\emph{Bedingung B:} Auch diese Bedingung wird von dem betrachteten Graphen erfüllt, sodass die bipartiten Subgraphen $G[\mathcal{B},\mathcal{G}]$ und $G[\mathcal{R},\mathcal{G}]$ jeweils eine disjunkte Vereinigung von Sternen sind und $G[\mathcal{B},\mathcal{R}]$ ein leerer Graph ist.\\

Um nachfolgend geeignet auf die globalen Eigenschaften des vorgestellten Graphenpaars eingehen zu können, wird in Abbildung \ref{fig:anwendungsbeispiel_cell} der zugehörige Zellgraph aufgezeichnet, welcher für beide Graphen identisch ist.

\begin{figure}[t]
	\centering
	\begin{tikzpicture}
		\begin{scope}
			\node[main node] (1) {$2$};
			\node[main node] (2) [fill=green!30,below left = 0.5cm and 0.85cm of 1] {$2$};
			\node[main node] (3) [dashed,fill=red!30,below = 1cm of 1] {$4$};
			
			\path[draw,thick,dashed] (1) edge node {} (2);
			\path[draw,thick,dashed] (2) edge node {} (3);
			\path[draw,thick] (1) edge node {} (3);
		\end{scope}
		\begin{scope}[xshift=4cm]
			\node[main node] (1) [fill=white] {1};
			\node[main node] (2) [fill=white,dashed,below = 0.15cm of 1] {2};
			
			\node (t1) [right = 0.2cm of 1] {homogene Zelle};
			\node (t2) [right = 0.2cm of 2] {heterogene Zelle};
			
			\node[bezier] (31) [below left = 0.55cm and 0.15cm of 2] {};
			\node[bezier] (32) [right = 0.85cm of 31] {};
			\path[draw,thick] (31) edge node {} (32);
			
			\node[bezier] (41) [below = 0.75cm of 31] {};
			\node[bezier] (42) [right = 0.85cm of 41] {};
			\path[draw,thick,dashed] (41) edge node {} (42);
			
			\node (t3) [right = 0.12cm of 32] {isotrope Kante};
			\node (t4) [right = 0.12cm of 42] {anisotrope Kante};
			
			\node[main node] (5) [fill = white, below = 1.6cm of 2] {$x$};
			\node (t5) [right = 0.2cm of 5] {Kardinalität $x$};
			
		\end{scope}
	\end{tikzpicture}
	\caption{Der zu dem Beispiel aus Abbildung \ref{fig:anwendungsbeispiel} passende Zellgraph, welcher für beide Graphen identisch ist.}
	\label{fig:anwendungsbeispiel_cell}
\end{figure}

\emph{Bedingung C:} Da der vorgestellte Graph nur die heterogene Zelle $\mathcal{R}$ enthält, kann es keinen anisotropen Pfad zwischen zwei heterogenen Zellen geben.
Diese Voraussetzung ist also erfüllt.

\emph{Bedingung D:} Der Graph enthält auch keinen gleichmäßigen, anisotropen Zyklus, da die Kante $\{\mathcal{B},\mathcal{R}\}$ isotrop ist.
Somit ist diese Bedingung ebenso erfüllt.

\emph{Bedingung E:} Der in \emph{E} beschriebene anisotrope Pfad muss mindestens drei Zellen enthalten, was in diesem Beispiel nur durch den Pfad $\mathcal{B}\mathcal{G}\mathcal{R}$ gegeben ist.
Dieser erfüllt allerdings nicht die Bedingung $|\mathcal{B}|<|\mathcal{G}|>|\mathcal{R}|$.
Außerdem ist kein anisotroper Zyklus vorhanden, weshalb Voraussetzung \emph{E} wie die vorherhigen Bedingungen ebenfalls erfüllt ist.

\emph{Bedingung F:} Der Pfad $\mathcal{G}\mathcal{R}$ trifft auf die Beschreibung aus der Bedingung zu, da $|\mathcal{G}|<|\mathcal{R}|$ ist und die Zelle $\mathcal{R}$ heterogen ist.
Somit ist diese Bedingung nicht erfüllt und es kann aus \emph{A-F} gefolgert werden, dass der Graph kein CR-Graph ist.\\

Der Vollständigkeit halber werden im Folgenden außerdem Bedingungen \emph{G} und \emph{H} überprüft werden, um zu zeigen, dass auch das Überprüfen der Bedingungen \emph{A,B,G} und \emph{H} ausreicht, um den Graphen als nicht-CR-Graphen zu entlarven.
Dabei gibt es im vorgestellten Graphen drei unterschiedliche anisotrope Komponenten, welche aus mehr als einem Knoten bestehen, nämlich $\{\mathcal{B},\mathcal{G}\}$, $\{\mathcal{G},\mathcal{R}\}$ und $\{\mathcal{B},\mathcal{G},\mathcal{R}\}$.\\

\emph{Bedingung G:} Eine anisotrope Komponente, welche die Monotonieeigenschaft nicht erfüllt, müsste mindestens drei Zellen enthalten, weshalb nur die Komponente $\{\mathcal{B},\mathcal{G},\mathcal{R}\}$ infrage käme.
Diese erfüllt diese Eigenschaft allerdings, egal ob $\mathcal{B}$ oder $\mathcal{G}$ als Wurzel definiert werden.
Es lässt sich im vorgestellten Graphen also keine anisotrope Komponente finden, für die die Monotonieeigenschaft nicht erfüllt ist, wodurch die Voraussetzung erfüllt ist.

\emph{Bedingung H:} Für die anisotrope Komponente $\{\mathcal{G},\mathcal{R}\}$ ist diese Voraussetzung nicht erfüllt.
Diese enthält zwar nur die heterogene Zelle $\mathcal{R}$, diese besitzt allerdings nicht die minimale Kardinalität innerhalb der Komponente.
Somit ist auch hier erkennbar, dass die Bedingungen \emph{A,B,G} und \emph{H} zusammen ausreichen, um zu erkennen, dass der Graph kein CR-Graph ist.

\subsection{Laufzeit}
Zur Berechnung der Laufzeit wird im Folgenden davon ausgegangen, dass der Graph $G$ in Adjazenzlistendarstellung vorliegt.
Nach \cite{CARDON198285} lässt sich die stabile Partition eines Graphen $G$ in Zeit $\mathcal{O}((n+m)\log n)$ berechnen.

\begin{Theorem}
	Die Klasse der CR-Graphen ist in Zeit $\mathcal{O}((n+m)\log n)$ entscheidbar. Dabei bezeichnet $n$ die Anzahl der Knoten und $m$ die Anzahl der Kanten des Eingabegraphen.
\end{Theorem}

\emph{Beweis:} Zunächst wird die stabile Partition $\mathcal{P}_G=\{X_1,X_2,...,X_k\}$ berechnet, was wie eingangs erwähnt die Laufzeit $\mathcal{O}((n+m)\log n)$ benötigt.
Außerdem wird $C^*(G)$ definiert als der Zellgraph, bei dem sämtliche leeren Kanten, also solche bei denen keine Verbindungen zwischen den Elementen der beiden Endpunkte besteht, entfernt wurden.

Für alle Zellen $X_i\in C^*(G)$ werden die Adjazenzlisten gebildet, indem die Adjazenzliste eines beliebigen Knoten $u\in X_i$ durchlaufen wird und sämtliche Zellen aufgelistet werden, welche einen zu $u$ adjazenten Knoten enthalten.
Die dadurch gewonnenen Informationen sind identisch für alle Knoten aus $X_i$, da diese alle gleichartige Nachbarschaften besitzen, weshalb es ausreicht die Operation für einen beliebigen Knoten durchzuführen.
Durch die Informationen aus der Adjazenzliste lässt sich der Grad der Knoten innerhalb der Zellen bestimmen und somit leicht Bedingung \emph{A} durch die in Lemma \ref{lemma:lokal_regulaer} vorgestellten Bedingungen für jeden Subgraphen $G[X_i]$ überprüfen.

Für jede Kante ${X_i,X_j}$ aus $C^*(G)$ wird der Wert $d_{ij}$ berechnet, welcher die Anzahl der Nachbarn in $X_j$ beschreibt, zu denen jeder Knoten aus $X_i$ adjazent ist.
Dieser Wert wird ebenfalls für den Fall $i=j$ betrachtet, wobei die Nachbarn innerhalb der Zelle gezählt werden.
Dadurch, dass die Werte $|X_i|$, $|X_j|$ und $d_{ij}$ nun bekannt sind, lässt sich Bedingung \emph{B} durch die in Lemma \ref{lemma:lokal_bipartit} vorgestellten Bedingungen überprüfen.

Da alle Zellen des Zellgraphen $C^*(G)$ im schlimmsten Falle unterschiedliche Farben haben, gibt es maximal $n$ Zellen.
Mit dem beschriebenen Verfahren können die Bedingungen \emph{A} und \emph{B} somit in der Zeit $\mathcal{O}(n)$ überprüft werden.

Zum Überprüfen von Bedingung \emph{H} wird eine Breitensuche auf dem Zellgraphen $C^*(G)$ durchgeführt, welche alle anisotropen Komponenten findet und gleichzeitig überprüft, ob diese eine Baumstruktur aufweisen und nur eine heterogene Zelle enthält.

Wird diese Breitensuche nun von der Zelle minimaler Kardinalität für jede Komponente wiederholt, so lässt sich die in Bedingung \emph{G} beschriebene Monotonieeigenschaft für jede Kante überprüfen.

Der Breitensuchealgorithmus benötigt eine Laufzeit von $\mathcal{O}(n+m)$, da der Zellgraph maximal $n$ Knoten und maximal $m$ Kanten besitzt.

Es ist somit zu erkennen, dass das Errechnen der stabilen Partition, auf der die ganzen Operationen ausgeführt werden mit $\mathcal{O}((n+m)\log n)$ die dominierende Laufzeit des Algorithmus ist.